
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="blue-grey">
  <script src="_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Installation and operation &#8212; Caltech DIBS</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/material.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="General information" href="general.html" />
    <link rel="prev" title="System architecture" href="architecture.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=deep-orange data-md-color-accent=teal>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#installation" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="Caltech DIBS"
           class="md-header-nav__button md-logo">
          
              <img src="_static/dibs-icon-white-sm.png" height="26"
                   alt="Home logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Caltech DIBS</span>
          <span class="md-header-nav__topic"> Installation and operation </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/caltechlibrary/dibs/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Caltech DIBS
  </div>
</a>
          </div>
        </div>
      
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Home</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="Caltech DIBS" class="md-nav__button md-logo">
      
        <img src="_static/dibs-icon-white-sm.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="index.html"
       title="Caltech DIBS">Caltech DIBS</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/caltechlibrary/dibs/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Caltech DIBS
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="usage.html" class="md-nav__link">Using DIBS</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="usage.html#authentication" class="md-nav__link">Authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="usage.html#front-page" class="md-nav__link">Front page</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="usage.html#the-patron-experience" class="md-nav__link">The patron experience</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="usage.html#the-staff-experience" class="md-nav__link">The staff experience</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="usage.html#the-scanning-workflow" class="md-nav__link">The scanning workflow</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="architecture.html" class="md-nav__link">System architecture</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="architecture.html#design-goals" class="md-nav__link">Design goals</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="architecture.html#architectural-overview" class="md-nav__link">Architectural overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="architecture.html#the-dibs-server-in-detail" class="md-nav__link">The DIBS server in detail</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="architecture.html#the-dibs-database-in-detail" class="md-nav__link">The DIBS database in detail</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="architecture.html#the-iiif-server-in-detail" class="md-nav__link">The IIIF server in detail</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Installation and operation </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Installation and operation</a>
      
        
<nav class="md-nav md-nav--secondary">
  <ul class="md-nav__list" data-md-scrollfix="">
  </ul>
</nav>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="#preliminary-requirements" class="md-nav__link">Preliminary requirements</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#installation" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#configuration" class="md-nav__link">Configuration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#running-dibs" class="md-nav__link">Running DIBS</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#administrative-utilities" class="md-nav__link">Administrative utilities</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="general.html" class="md-nav__link">General information</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="faqs.html" class="md-nav__link">FAQs about DIBS</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="history.html" class="md-nav__link">DIBS history</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="references.html" class="md-nav__link">References and resources</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="colophon.html" class="md-nav__link">Colophon</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
  <ul class="md-nav__list" data-md-scrollfix="">
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="installation-and-operation">
<h1 id="installation--page-root">Installation and operation<a class="headerlink" href="#installation--page-root" title="Permalink to this heading">¶</a></h1>
<p>On this page, you may wish to follow one of the following paths based to your situation. (Note: the boxes in this diagram are clickable links to the sections in question.)</p>
<div align="center">
<div class="mermaid">
            flowchart TD;
  node1(Preliminary requirements)--&gt;node2(Installation);

  node2--&gt;node3(Configuring DIBS for a local test);
  node2--&gt;node4(Configuring DIBS for multiuser use);

  node3--&gt;node5(Running DIBS in test/debug mode);
  node4--&gt;node6(Running DIBS in production);

  style node1 fill:white, stroke:orange;
  style node2 fill:white, stroke:orange;
  style node3 fill:white, stroke:orange;
  style node4 fill:white, stroke:orange;
  style node5 fill:white, stroke:orange;
  style node6 fill:white, stroke:orange;

  click node1 "/dibs/installation.html#preliminary-requirements" _self;
  click node2 "/dibs/installation.html#installation" _self;
  click node3 "/dibs/installation.html#configuring-dibs-for-a-local-test" _self;
  click node4 "/dibs/installation.html#configuring-dibs-for-multiuser-use" _self;
  click node5 "/dibs/installation.html#running-dibs-locally" _self;
  click node6 "/dibs/installation.html#running-dibs-in-production" _self;
        </div></div>
<section id="preliminary-requirements">
<h2 id="preliminary-requirements">Preliminary requirements<a class="headerlink" href="#preliminary-requirements" title="Permalink to this heading">¶</a></h2>
<p>The core DIBS server is written in <a class="reference external" href="https://www.python.org">Python 3</a> and makes use of some additional Python software libraries that are installed automatically during the <span class="xref myst">installation steps</span>. It also assumes a Unix-like environment (Linux, macOS) and a working Internet connection.</p>
<p>Although DIBS relies on the existence of a IIIF image server, for initial exploration, you <em>don’t</em> need to set up a IIIF server – you can reference content located in any of a number of publicly-accessible IIIF servers around the world, and DIBS includes a sample <a class="reference external" href="https://iiif.io/explainers/using_iiif_resources/#iiif-manifest">IIIF manifest</a> as an example of doing that. Thus, in principle, all you need to run the DIBS demo is a Unix-like system (Linux, macOS), a Python installation, the DIBS source code, and an Internet connection.</p>
<p>To run a proper DIBS server at another institution (other than <a class="reference external" href="https://www.caltech.edu">Caltech</a>), certain additional things are needed:</p>
<ol class="arabic simple">
<li><p>A <strong>IIIF server</strong>. At Caltech, we use a <a class="reference external" href="https://github.com/nulib/serverless-iiif">serverless component</a> running on an Amazon cloud instance, but <a class="reference external" href="https://github.com/IIIF/awesome-iiif#image-servers">many other IIIF server options exist</a>. If you’re looking at DIBS, presumably it means you want to serve content that is not freely available in a public IIIF server, which means you will need to set up a server of your own.</p></li>
<li><p>A <strong>web server</strong> to host DIBS.  The current version of DIBS has only been tested with Apache2 on Linux (specifically, Ubuntu 20) and macOS (specifically 10.14, Mojave). DIBS comes with a <a class="reference external" href="https://github.com/caltechlibrary/dibs/blob/main/adapter.wsgi">WSGI adapter file</a> adapter file and <a class="reference external" href="https://github.com/caltechlibrary/dibs/blob/main/dibs.conf-example">sample config file for Apache</a>, but it should be possible to run DIBS in other WSGI-compliant servers.</p></li>
<li><p>An <strong>authentication layer</strong>. DIBS assumes that the web server takes care of user authentication in such a way that DIBS is behind the authentication layer and all users who can reach DIBS pages are allowed to view content. DIBS itself only implements checks to distinguish between regular users versus staff who are allowed to access restricted pages. For the authentication layer, at Caltech we use the <a class="reference external" href="https://en.wikipedia.org/wiki/Shibboleth_Single_Sign-on_architecture">Shibboleth</a> single sign-on system, but it is possible to use other schemes. For a local server behind firewalls, <a class="reference external" href="https://httpd.apache.org/docs/2.4/howto/auth.html">Apache Basic Authentication</a> can also be used. The installation and configuration of a single sign-on system depends on the specifics of a given institution, and are not described here.</p></li>
<li><p>The use of <a class="reference external" href="https://www.folio.org">FOLIO</a> LSP or <a class="reference external" href="https://tind.io">TIND</a> ILS for retrieving metadata based on barcodes or unique identifiers, <em>or</em>  a willingness to extend the existing metadata retrieval layer in DIBS. We strove to limit dependencies on external systems, but the interface for staff to add items to DIBS requires looking up some limited metadata based on an item’s barcode, and lacking a universal scheme to do that, we had to write our own interface layer. The use of another LSP will require extending this interface layer. (Thankfully, the <a class="reference external" href="https://github.com/caltechlibrary/dibs/blob/main/dibs/lsp.py">code is short</a> and the amount of metadata required is small.)</p></li>
<li><p>Modification to the HTML templates to change the branding. The template files in <a class="reference external" href="https://github.com/caltechlibrary/dibs/blob/main/dibs/templates"><code class="docutils literal notranslate"><span class="pre">dibs/templates</span></code></a> are specific to Caltech, and will need to be edited to suit another installation. (We are open to making the branding customization easier and would welcome a <a class="reference external" href="https://docs.github.com/en/github/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests">pull request</a> for suitable changes!)</p></li>
</ol>
</section>
<section id="installation">
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h2>
<p>Installing DIBS is simple. It only requires downloading a copy of the software, installing Python software dependencies, and editing a configuration file.  DIBS currently does <strong>not</strong> have separate installation destination –  running DIBS means running it from the source directory.</p>
<section id="download-a-copy-of-the-software">
<h3 id="download-a-copy-of-the-software">Download a copy of the software<a class="headerlink" href="#download-a-copy-of-the-software" title="Permalink to this heading">¶</a></h3>
<p>There are several ways of getting the latest release of the DIBS source code. Here is one of the simplest:</p>
<ol class="arabic simple">
<li><p>Go to the <a class="reference external" href="https://github.com/caltechlibrary/dibs/releases">releases page</a> in the GitHub repository for DIBS.</p></li>
<li><p>Find the latest release there (normally the first one on the page). <a class="reference internal" href="https://github.com/caltechlibrary/dibs/raw/main/.graphics/assets.png"><img alt="https://github.com/caltechlibrary/dibs/raw/main/.graphics/assets.png" class="align-right" src="https://github.com/caltechlibrary/dibs/raw/main/.graphics/assets.png" style="width: 200px;"/></a></p></li>
<li><p>Find the <strong>Assets</strong> section of the release.</p></li>
<li><p>Click on the link titled <strong>Source code</strong> (zip); it will be downloaded.</p></li>
<li><p>Unzip the file.</p></li>
</ol>
<p>The result will be a subdirectory named <code class="docutils literal notranslate"><span class="pre">dibs</span></code>, which contains the source code.  It should look more or less like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── CHANGES.md
├── CITATION.cff
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── INSTALL-Python3.md
├── INSTALL.txt
├── LICENSE
├── LICENSE.html
├── Makefile
├── People-Manager.md
├── README.md
├── SUPPORT.md
├── adapter.wsgi
├── admin/
├── codemeta.json
├── data/
├── dev/
├── dibs/
├── dibs.conf-example
├── docs/
├── htdocs/
├── requirements.txt
├── settings.ini-example
├── setup.cfg
├── setup.py
├── tests/
└── viewer/
</pre></div>
</div>
</section>
<section id="install-python-dependencies">
<h3 id="install-python-dependencies">Install Python dependencies<a class="headerlink" href="#install-python-dependencies" title="Permalink to this heading">¶</a></h3>
<p>Assuming that your copy of DIBS is in a subdirectory named <code class="docutils literal notranslate"><span class="pre">dibs</span></code> (as it would be after the previous step), change your shell’s current working directory to that directory, and run the following command to install the Python dependencies on your system or your virtual environment:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python3 -m pip install -r requirements.txt
</pre></div>
</div>
</section>
</section>
<section id="configuration">
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">¶</a></h2>
<p>If you are new to DIBS and all you want to do is test drive it, you can follow the instructions in the first subsection below. If you are setting up DIBS for multiuser use, you can <span class="xref myst">jump ahead to the second subsection</span>.</p>
<section id="configuring-dibs-for-a-local-test">
<h3 id="configuring-dibs-for-a-local-test">Configuring DIBS for a local test<a class="headerlink" href="#configuring-dibs-for-a-local-test" title="Permalink to this heading">¶</a></h3>
<p>DIBS comes with an example IIIF manifest that uses a public IIIF server operated by the <a class="reference external" href="https://wellcomelibrary.org">Wellcome Library</a>. (Thank you, Wellcome Library!) This makes it possible to run a local copy of DIBS without much effort. Please follow the simple steps below.</p>
<section id="create-the-settings-ini-file">
<h4 id="create-the-settings-ini-file">① Create the <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code> file<a class="headerlink" href="#create-the-settings-ini-file" title="Permalink to this heading">¶</a></h4>
<p>The file <code class="docutils literal notranslate"><span class="pre">settings.ini-example</span></code> is a sample configuration file. For a test run of DIBS, it is enough to simply copy the example to create <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>cp settings.ini-example settings.ini
</pre></div>
</div>
</section>
<section id="load-a-sample-book-into-dibs">
<h4 id="load-a-sample-book-into-dibs">⓶ Load a sample book into DIBS<a class="headerlink" href="#load-a-sample-book-into-dibs" title="Permalink to this heading">¶</a></h4>
<p>Prior to starting the DIBS server for the first time, for testing purposes, you may want to add some sample data. This can be done by running the script <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">load-mock-data</span></code></span> located in the <code class="docutils literal notranslate"><span class="pre">admin</span></code> subdirectory of the DIBS source code tree.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>admin/load-mock-data
</pre></div>
</div>
</section>
<section id="set-a-sample-users-role">
<h4 id="set-a-sample-users-role">⓷ Set a sample user’s role<a class="headerlink" href="#set-a-sample-users-role" title="Permalink to this heading">¶</a></h4>
<p>The program <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">people-manager</span></code></span> in the <code class="docutils literal notranslate"><span class="pre">admin</span></code> subdirectory is an interface for adding user and role information.  To be able to manage DIBS content, create at least one user with a role of “library”.  Suppose you want to name your sample user “dibsuser”, then you could run the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>admin/people-manager add <span class="nv">role</span><span class="o">=</span><span class="s2">"library"</span> <span class="nv">uname</span><span class="o">=</span><span class="s2">"dibsuser"</span>
</pre></div>
</div>
<p>After this, proceed to the section on <span class="xref myst">Running DIBS locally</span> below.</p>
</section>
</section>
<section id="configuring-dibs-for-multiuser-use">
<h3 id="configuring-dibs-for-multiuser-use">Configuring DIBS for multiuser use<a class="headerlink" href="#configuring-dibs-for-multiuser-use" title="Permalink to this heading">¶</a></h3>
<p>Setting up an actual server in an institutional setting will require a little bit more configuration work, as well as a IIIF server that you can use.</p>
<section id="create-and-edit-the-settings-ini-file">
<h4 id="create-and-edit-the-settings-ini-file">①  Create and edit the <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code> file<a class="headerlink" href="#create-and-edit-the-settings-ini-file" title="Permalink to this heading">¶</a></h4>
<p>Certain characteristics are configured using a file named <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code>, which DIBS looks for in the <code class="docutils literal notranslate"><span class="pre">dibs</span></code> directory. The file <code class="docutils literal notranslate"><span class="pre">settings.ini-example</span></code> is a sample configuration file for DIBS.  Copy the file to <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code>,</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>cp settings.ini-example settings.ini
</pre></div>
</div>
<p>then edit its contents in a text editor to suit your local installation. The comments in the file explain what each of the variables does, but we elaborate on some notable variables below:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LSP_TYPE</span></code>: When items are added to DIBS via the web form, the system looks up basic metadata about an item in an LSP or ILS. This variable determines the adapter layer used. Currently, the only two options are <code class="docutils literal notranslate"><span class="pre">folio</span></code> or <code class="docutils literal notranslate"><span class="pre">tind</span></code>. Also make sure to <strong>set the corresponding variables in the sections for <code class="docutils literal notranslate"><span class="pre">[folio]</span></code> or <code class="docutils literal notranslate"><span class="pre">[tind]</span></code></strong>, respectively, near the bottom of the <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code> file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MANIFEST_DIR</span></code>: This variable sets the path to the directory where DIBS looks for manifest files.  Each file name should follow the pattern <i><code>N</code></i><code>-manifest.json</code>, where <i><code>N</code></i> is the item barcode.  The source distribution of DIBS comes with a sample manifest for illustration purposes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PROCESS_DIR</span></code>: The section on <span class="xref myst">the scanning workflow</span> describes the basic scheme that DIBS implements for initiating an external workflow that will convert book scans into the format needed by IIIF.  This scheme involves reading and writing files to the directory indicated by the variable <code class="docutils literal notranslate"><span class="pre">PROCESS_DIR</span></code> in the settings file.  When a new item is added to DIBS from the /list page, a button named <span class="button color-primary">Process</span> is shown next to the new item; when library staff press that button, DIBS writes a file in the <code class="docutils literal notranslate"><span class="pre">PROCESS_DIR</span></code> location and watches for the presence of other files.  The end point of the workflow is assumed to be the appearance of a IIIF manifest for the item in the <code class="docutils literal notranslate"><span class="pre">MANIFEST_DIR</span></code>. f you do not want to use the workflow scheme, leave this value empty; DIBS will skip the <span class="button color-primary">Process</span> button, and will only monitor for the existence of the manifest file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IIIF_BASE_URL</span></code>: The value of this variable should have the form <code class="docutils literal notranslate"><span class="pre">https://youriiifserver.yourdomain.edu/iiif/2</span></code>, and it should be the common base for IIIF URLs served by your IIIF server. (This means that the value should appear throughout your manifest files, as the common root of all page images.) This URL will not be shared with clients.  <strong>You should protect this URL from becoming public</strong> if you are making copyrighted works available via DIBS, because knowledge of this URL would allow anyone with familiarity with IIIF to bypass restrictions in DIBS and access your IIIF content directly. When DIBS reads a manifest, it replaces all instances of the value of <code class="docutils literal notranslate"><span class="pre">IIIF_BASE_URL</span></code> with a URL rooted at the DIBS server’s address, and this modified manifest is what it serves to clients. When a client requests page images via the translated URL, DIBS reverses the transformation to construct the IIIF URL from where it can get the page image, and then returns that data back to the client. The client never sees the real URL of the IIIF server or the images. The <em>controlled digital lending</em> aspect of DIBS is that it also refuses to return IIIF content unless the client has been authenticated and the user has borrowed the item through DIBS’ loan system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MAIL_HOST</span></code>, <code class="docutils literal notranslate"><span class="pre">MAIL_PORT</span></code>, <code class="docutils literal notranslate"><span class="pre">MAIL_SENDER</span></code>: When a patron starts a loan, DIBS send send them an email message that summarizes information about the loan, including a link to the viewer page. The destination address for the email message is the sign-on received from the authentication layer.  The variables <code class="docutils literal notranslate"><span class="pre">MAIL_HOST</span></code>, <code class="docutils literal notranslate"><span class="pre">MAIL_PORT</span></code>, and <code class="docutils literal notranslate"><span class="pre">MAIL_SENDER</span></code> set the mail server details used by DIBS. Note that for this to work, the account owning the web server process must be able to send email from the machine where the web server is running to the patrons.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FEEDBACK_URL</span></code>: After a patron ends a loan, they are taken to thank-you page on which is shown a link to a feedback page. This variable sets the web address of the feedback form. At Caltech, we use a simple Google form with only three questions; you may wish to do something similar, or perhaps use an existing issue tracking/feedback system at your site.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RUN_MODE</span></code>: This variable takes one of two values: <code class="docutils literal notranslate"><span class="pre">normal</span></code> or <code class="docutils literal notranslate"><span class="pre">verbose</span></code>. In <code class="docutils literal notranslate"><span class="pre">verbose</span></code> mode, DIBS logs debug-level information in the server logs (or the standard output, if being run using the <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">run-server</span></code></span> program included with DIBS). Patron names/email addresses are anonymized, so there is relatively little privacy risk in running in <code class="docutils literal notranslate"><span class="pre">verbose</span></code> mode in production. It can be very useful to use <code class="docutils literal notranslate"><span class="pre">verbose</span></code> mode while learning how DIBS works, even if you later decide to switch to <code class="docutils literal notranslate"><span class="pre">normal</span></code>.</p></li>
</ul>
</section>
<section id="set-up-authentication-for-dibs">
<h4 id="set-up-authentication-for-dibs">⓶ Set up authentication for DIBS<a class="headerlink" href="#set-up-authentication-for-dibs" title="Permalink to this heading">¶</a></h4>
<p>The details of this step depend on your particular institutional requirements and local system configuration. If you are using a single sign-on system such as Shibboleth, you may need to do configuration and other steps in your server environment, but it is beyond the scope of this document to explain how that can be done.</p>
<p>If you are setting up a server behind a firewall (perhaps for local development of a new DIBS site, or within some other closed environment) and want to use <a class="reference external" href="https://httpd.apache.org/docs/2.4/howto/auth.html">basic authentication in Apache</a>, take the following steps:</p>
<ul>
<li><p>Uncomment the variables <code class="docutils literal notranslate"><span class="pre">HTPASSWD</span></code> and <code class="docutils literal notranslate"><span class="pre">PASSWORD_FILE</span></code> in your <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code> file, and set them to point to the <code class="docutils literal notranslate"><span class="pre">htpasswd</span></code> program on your system and the file you will use to store encrypted passwords, respectively.</p></li>
<li><p>Enable <code class="docutils literal notranslate"><span class="pre">AuthType</span> <span class="pre">Basic</span></code> in your Apache configuration. The location of the configuration file depends on the way Apache is set up on your system; as an example, on our internal development server running on Ubuntu the location is <code class="docutils literal notranslate"><span class="pre">/etc/apache2/sites-available/apps-le-ssl.conf</span></code>. Here’s an example of what the configuration can look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># DIBS comes with an adapter.wsgi file ready to use.</span>
<span class="n">WSGIScriptAlias</span> <span class="o">/</span><span class="n">dibs</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">sites</span><span class="o">/</span><span class="n">dibs</span><span class="o">/</span><span class="n">adapter</span><span class="o">.</span><span class="n">wsgi</span>
<span class="o">&lt;</span><span class="n">Location</span> <span class="o">/</span><span class="n">dibs</span><span class="o">&gt;</span>
        <span class="n">AuthType</span> <span class="n">Basic</span>
        <span class="n">AuthName</span> <span class="s2">"DIBS"</span>
        <span class="n">AuthBasicProvider</span> <span class="n">file</span>
        <span class="n">AuthUserFile</span> <span class="s2">"/var/www/sites/dibs/password.txt"</span>
        <span class="n">require</span> <span class="n">valid</span><span class="o">-</span><span class="n">user</span>
<span class="o">&lt;/</span><span class="n">Location</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
<p>The value of the <code class="docutils literal notranslate"><span class="pre">AuthUserFile</span></code> <strong>must match the path in</strong> <code class="docutils literal notranslate"><span class="pre">PASSWORD_FILE</span></code> used in the DIBS <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code> file.</p>
</section>
<section id="add-staff-users">
<h4 id="add-staff-users">⓷ Add staff users<a class="headerlink" href="#add-staff-users" title="Permalink to this heading">¶</a></h4>
<p>As mentioned above, DIBS needs to distinguish between users who are allowed to perform administrative tasks (such as adding new items for loans and setting loan parameters) and regular users. The program <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">people-manager</span></code></span> in the <code class="docutils literal notranslate"><span class="pre">admin</span></code> subdirectory is an interface for telling DIBS about users who have staff privileges.  To be able to manage DIBS content, <strong>create at least one user with a role of <code class="docutils literal notranslate"><span class="pre">library</span></code></strong>.</p>
<p>If you are using Apache basic auth, <code class="docutils literal notranslate"><span class="pre">people-manager</span></code> will also allow you to add entries (with passwords) to the password file indicated by the <code class="docutils literal notranslate"><span class="pre">PASSWORD_FILE</span></code> variable in DIBS’ <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code> file.</p>
<p>The user name must be given as the name used by people in the authentication system (e.g., the SSO sign-on login name, if you use SSO). For example, to make <code class="docutils literal notranslate"><span class="pre">fakeuser2021@someuniversity.edu</span></code> be recognized as having staff privileges, you would run the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>admin/people-manager add <span class="nv">role</span><span class="o">=</span><span class="s2">"library"</span> <span class="nv">uname</span><span class="o">=</span><span class="s2">"fakeuser2021@someuniversity.edu</span>
</pre></div>
</div>
</section>
<section id="set-permissions-on-important-dibs-directories">
<h4 id="set-permissions-on-important-dibs-directories">④ Set permissions on important DIBS directories<a class="headerlink" href="#set-permissions-on-important-dibs-directories" title="Permalink to this heading">¶</a></h4>
<p>A server process such as Apache normally runs with a user identity and group identity that is different from real user accounts on the server computer. This means that the files and directories for DIBS, when they are installed by a user on the computer, may have different ownership and permissions than are needed by the web server process. To make sure that the web server process can read and write to the directories, DIBS comes with a small program to set permissions on certain critical DIBS files and directories. Run this program as shown below, replacing <code class="docutils literal notranslate"><span class="pre">PROCESS_USER</span></code> and <code class="docutils literal notranslate"><span class="pre">PROCESS_GROUP</span></code> with the actual server process user and group (and note the use of <code class="docutils literal notranslate"><span class="pre">sudo</span></code> here):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo admin/set-server-permissions --owner PROCESS_USER --group PROCESS_GROUP
</pre></div>
</div>
<p>For example, on our servers, <code class="docutils literal notranslate"><span class="pre">PROCESS_USER</span></code> and <code class="docutils literal notranslate"><span class="pre">PROCESS_GROUP</span></code> are both <code class="docutils literal notranslate"><span class="pre">www-data</span></code>, so for our installation, the command uses the arguments <code class="docutils literal notranslate"><span class="pre">--owner</span> <span class="pre">www-data</span> <span class="pre">--group</span> <span class="pre">www-data</span></code>.</p>
<p>Note: make sure to <strong>run <code class="docutils literal notranslate"><span class="pre">set-server-permissions</span></code> after running <code class="docutils literal notranslate"><span class="pre">people-manager</span></code></strong> for the first time, so that <code class="docutils literal notranslate"><span class="pre">set-server-permissions</span></code> can set the permissions on the DIBS database file.</p>
</section>
<section id="set-up-your-iiif-server">
<h4 id="set-up-your-iiif-server">⑤ Set up your IIIF server<a class="headerlink" href="#set-up-your-iiif-server" title="Permalink to this heading">¶</a></h4>
<p>A fully functioning DIBS installation requires a IIIF server where you put content to be served via DIBS. A final step is thus to set up a IIIF server for DIBS’ use. The instructions for doing so depend on the specific server used – please refer to the relevant documentation for whatever IIIF server you are using.</p>
<p>Once a IIIF server is running, set the value of the <code class="docutils literal notranslate"><span class="pre">IIIF_BASE_URL</span></code> variable in the file <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code> appropriately.</p>
</section>
</section>
</section>
<section id="running-dibs">
<h2 id="running-dibs">Running DIBS<a class="headerlink" href="#running-dibs" title="Permalink to this heading">¶</a></h2>
<p>You can run DIBS on your local computer for initial exploration and testing, as well as during development and customization of DIBS. This is easy to do using the <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">run-server</span></code></span> program provided with DIBS. On the other hand, running DIBS on a real server, for actual use by patrons at your institution, requires the use of a full web server environment and other components. Both cases are described below.</p>
<section id="running-dibs-locally">
<h3 id="running-dibs-locally">Running DIBS locally<a class="headerlink" href="#running-dibs-locally" title="Permalink to this heading">¶</a></h3>
<p>For local experimentation and development, the script <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">run-server</span></code></span> can be used to start a built-in web server on your computer. Since a local environment will not have the authentication layer normally assumed by DIBS, you need to tell the built-in web server who to pretend to be. For example, if you used <code class="docutils literal notranslate"><span class="pre">people-manager</span></code> to add a user named “dibsuser” as <span class="xref myst">described in the section on configuration</span>, then you can start the local server in debug mode like this:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>admin/run-server --mode debug --debug-user dibsuser
</pre></div>
</div>
<p>This will start a local web server listening on <code class="docutils literal notranslate"><span class="pre">localhost</span></code> port 8080.  Open a browser window on <code class="docutils literal notranslate"><span class="pre">http://localhost:8080</span></code> and you should see the DIBS welcome page, as well as be able to see the “List” and “Loan statistics” options in the pull-down menu:</p>
<div style="width:70%; margin-left: auto; margin-right: auto">
<p><img alt="Welcome page" src="_images/dropdown-menu.png"/></p>
</div>
<p>If you cannot access the welcome page, check the shell window for any messages that may provide clues about what went wrong. If you can see the page but do not have the “List” and “Loan statistics” items in the menu, then it means that there is a mismatch between the current user as set by the <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">run-server</span></code></span> command line (“dibsuser” in our example here) and the roles configured in DIBS using <code class="docutils literal notranslate"><span class="pre">people-manager</span></code>. Check that <span class="xref myst">the step described earlier</span> has been performed and the same user names are used in both places.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">debug</span></code> run mode changes the behavior of <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">run-server</span></code></span> in various useful ways. For example, it will automatically reload source files if any of them are edited. If you will be doing anything with DIBS such as editing the HTML templates, running with <code class="docutils literal notranslate"><span class="pre">--mode</span> <span class="pre">debug</span></code> is highly recommended.</p>
</section>
<section id="running-dibs-in-production">
<h3 id="running-dibs-in-production">Running DIBS in production<a class="headerlink" href="#running-dibs-in-production" title="Permalink to this heading">¶</a></h3>
<p>Note that <code class="docutils literal notranslate"><span class="pre">run-server</span></code> is <strong>not intended for use in production servers</strong>. For actual use, you must configure a web server such as <a class="reference external" href="https://httpd.apache.org">Apache</a> to host the system. DIBS comes with an <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">adapter.wsgi</span></code></span> and an example <span class="xref myst">Apache conf file</span> for this purpose to help you get started. The latter file configures the web server and tells it to use <code class="docutils literal notranslate"><span class="pre">adapter.wsgi</span></code> (also provided with DIBS) to define a WSGI application for DIBS.</p>
<p>To start DIBS in this environment, you most likely need to restart the Apache process on your system.</p>
</section>
</section>
<section id="administrative-utilities">
<h2 id="administrative-utilities">Administrative utilities<a class="headerlink" href="#administrative-utilities" title="Permalink to this heading">¶</a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">admin</span></code> subdirectory of the DIBS source tree, there are a number of administrative command-line utilities for DIBS. They implement operations that (currently) can only be performed by staff running shell commands on the DIBS server. The following sections describe what they are.</p>
<section id="export-data-export-data-from-a-dibs-database">
<h3 id="export-data-export-data-from-a-dibs-database"><code class="docutils literal notranslate"><span class="pre">export-data</span></code>: export data from a DIBS database<a class="headerlink" href="#export-data-export-data-from-a-dibs-database" title="Permalink to this heading">¶</a></h3>
<p>This program reads a DIBS database file and, based on the options given on the command line, writes one or more files containing the contents of one or more tables from the DIBS database.  Each table holds a different kind of model instance, such as <code class="docutils literal notranslate"><span class="pre">Item</span></code>, <code class="docutils literal notranslate"><span class="pre">History</span></code>, etc.  The default action is to put all the files into one ZIP archive as the output. You can run this program with the <code class="docutils literal notranslate"><span class="pre">-h</span></code> option to get more information about its usage.</p>
<p>This program and <code class="docutils literal notranslate"><span class="pre">import-data</span></code> (below) can be useful for migrating servers, backups, and other situations where you want to get the data out of (and possibly back into) the DIBS database.</p>
</section>
<section id="import-data-import-data-into-a-dibs-database">
<h3 id="import-data-import-data-into-a-dibs-database"><code class="docutils literal notranslate"><span class="pre">import-data</span></code>: import data into a DIBS database<a class="headerlink" href="#import-data-import-data-into-a-dibs-database" title="Permalink to this heading">¶</a></h3>
<p>This program is the opposite of <code class="docutils literal notranslate"><span class="pre">export-data</span></code>;  it takes a ZIP archive of JSON files previously exported by <code class="docutils literal notranslate"><span class="pre">export-data</span></code> (above), and loads a DIBS database using that data. The ZIP archive must contain 4 files corresponding to the 4 database object tables in a DIBS database. The path to the archive file is expected to be the last argument on the command line. You can run it with the <code class="docutils literal notranslate"><span class="pre">-h</span></code> option to get more information about its usage.</p>
</section>
<section id="load-mock-data-load-sample-data-into-dibs">
<h3 id="load-mock-data-load-sample-data-into-dibs"><code class="docutils literal notranslate"><span class="pre">load-mock-data</span></code>: load sample data into DIBS<a class="headerlink" href="#load-mock-data-load-sample-data-into-dibs" title="Permalink to this heading">¶</a></h3>
<p>When first starting out with DIBS, for testing purposes, you may want to add some sample data. The program <code class="docutils literal notranslate"><span class="pre">load-mock-data</span></code> can be used for this purpose. It takes no arguments and is intended to be run from the DIBS directory root:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>admin/load-mock-data
</pre></div>
</div>
</section>
<section id="loan-manager-perform-administrative-functions-on-loans">
<h3 id="loan-manager-perform-administrative-functions-on-loans"><code class="docutils literal notranslate"><span class="pre">loan-manager</span></code>: perform administrative functions on loans<a class="headerlink" href="#loan-manager-perform-administrative-functions-on-loans" title="Permalink to this heading">¶</a></h3>
<p>This program can be used to perform some loan management functions on a DIBS server. Currently, it offers functions for listing active and recent loans, as well as forcefully ending active loans on a given item. You can run it with the <code class="docutils literal notranslate"><span class="pre">-h</span></code> option to get more information about its usage. For example:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>admin/loan-manager --list-loans
</pre></div>
</div>
</section>
<section id="people-manager-manage-user-roles-in-dibss-people-table">
<h3 id="people-manager-manage-user-roles-in-dibss-people-table"><code class="docutils literal notranslate"><span class="pre">people-manager</span></code>: manage user roles in DIBS’s people table<a class="headerlink" href="#people-manager-manage-user-roles-in-dibss-people-table" title="Permalink to this heading">¶</a></h3>
<p>This administrative utility lets you simultaneously (1) add/remove/edit people’s roles in DIBS’s people table, and (2) do the same in a password file used for Apache basic auth (if you use that).</p>
<section id="background-authentication-and-access-control-in-dibs">
<h4 id="background-authentication-and-access-control-in-dibs">Background: authentication and access control in DIBS<a class="headerlink" href="#background-authentication-and-access-control-in-dibs" title="Permalink to this heading">¶</a></h4>
<p>There are 2 layers of access control in DIBS when deployed in a web server:</p>
<ol class="arabic simple">
<li><p>can an incoming user access any part of DIBS at all?</p></li>
<li><p>can the user access DIBS staff pages, or only patron pages?</p></li>
</ol>
<p>Layer #1 is implemented in the web server environment, and the details of how it’s done depends on the specifics of the installation.  As far as DIBS is concerned, it only cares about whether a user has been authenticated or not.  When a page or API endpoint is requested from DIBS, the request environment given to DIBS by the web server will either include a user identity (if the use has been authenticated) or not.  DIBS simply refuses access to everything it controls if a user identity is not present in the request environment.</p>
<p>Layer #2 is implemented in DIBS itself.  DIBS’s database uses Person objects to distinguish between people known to have staff access (i.e., who can access pages like <code class="docutils literal notranslate"><span class="pre">/list</span></code>), and everyone else.  When a request for a page or an endpoint comes in, DIBS looks for the user identifier in the HTTP request environment given to it from the web server, checks if that user is in the Person table, and checks if the user has a role of <code class="docutils literal notranslate"><span class="pre">library</span></code>.  If the role is <code class="docutils literal notranslate"><span class="pre">library</span></code>, access to staff pages is granted; if the Person entry doesn’t have a role of <code class="docutils literal notranslate"><span class="pre">library</span></code>, the user is not shown links to the staff pages nor can they access the relevant endpoints.</p>
</section>
<section id="managing-users-using-people-manager">
<h4 id="managing-users-using-people-manager">Managing users using <code class="docutils literal notranslate"><span class="pre">people-manager</span></code><a class="headerlink" href="#managing-users-using-people-manager" title="Permalink to this heading">¶</a></h4>
<p>One of <code class="docutils literal notranslate"><span class="pre">people-manager</span></code>’s purposes is to add and manage entries in DIBS’s Person table.  Only users who should have staff access (i.e., have role <code class="docutils literal notranslate"><span class="pre">library</span></code>) need to be added to the Person table, and in an SSO scenario, that’s all you need to deal with.</p>
<p>In an SSO scenario, the management of users in the authentication system is typically handled by another system and possibly another administrative entity at your institution.  In an Apache basic auth scenario, users are listed in a password file managed by the command-line program <code class="docutils literal notranslate"><span class="pre">htpasswd</span></code>, and the Apache server configuration is set up to read this password file.</p>
<p>If you are using Apache basic auth and <code class="docutils literal notranslate"><span class="pre">htpasswd</span></code>, and have enabled the relevant variables in the <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code> file, then <code class="docutils literal notranslate"><span class="pre">people-manager</span></code> will also manage entries in the password file.  Thus, in a basic auth scenario, you can use <code class="docutils literal notranslate"><span class="pre">people-manager</span></code> to simultaneously add/change users and their roles in the password file and make the corresponding changes in DIBS’s <code class="docutils literal notranslate"><span class="pre">Person</span></code> table.</p>
<p>Run the program with the option <code class="docutils literal notranslate"><span class="pre">help</span></code> to get a usage summary.</p>
</section>
</section>
<section id="run-server-start-a-local-dibs-server-for-testing">
<h3 id="run-server-start-a-local-dibs-server-for-testing"><code class="docutils literal notranslate"><span class="pre">run-server</span></code>: start a local DIBS server for testing<a class="headerlink" href="#run-server-start-a-local-dibs-server-for-testing" title="Permalink to this heading">¶</a></h3>
<p>For local experimentation and development, the script <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">run-server</span></code></span> can be used to start a local DIBS server on your computer. It looks for a file named <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code> in the current directory or the parent directory, and reads it to set various DIBS configuration variables. The command-line options to run-server can override some of the configuration values in <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code>.</p>
<section id="run-modes">
<h4 id="run-modes">Run modes<a class="headerlink" href="#run-modes" title="Permalink to this heading">¶</a></h4>
<p>There are 3 run modes available. Two of the modes can be set using the <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code> file, but are overriden via the option <code class="docutils literal notranslate"><span class="pre">--mode</span></code> on the command line.  If no <code class="docutils literal notranslate"><span class="pre">--mode</span></code> option is given, then this program uses the <code class="docutils literal notranslate"><span class="pre">RUN_MODE</span></code> value from <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code>. In addition, this program offers a third run mode only available using the <code class="docutils literal notranslate"><span class="pre">--mode</span></code> option. The possible run modes and their effects are as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">normal</span></code>: uses the Python <code class="docutils literal notranslate"><span class="pre">mod_wsgi-express</span></code> module without debugging options. The server will run multiple threads, will not reload if source files are changed, will not reload templates if they are changed, and will not stop for exceptions. It looks for a file named <code class="docutils literal notranslate"><span class="pre">adapter.wsgi</span></code> in the current directory and passes it to <code class="docutils literal notranslate"><span class="pre">mod_wsgi</span></code>. This mode is a close approximation to running DIBS in a basic Apache2 <code class="docutils literal notranslate"><span class="pre">mod_wsgi</span></code> environment, with <code class="docutils literal notranslate"><span class="pre">adapter.wsgi</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">verbose</span></code>: like normal mode, but will produce detailed logging to the terminal.  This mode is useful for testing DIBS using <code class="docutils literal notranslate"><span class="pre">adapter.wsgi</span></code> in <code class="docutils literal notranslate"><span class="pre">mod_wsgi</span></code>.  Verbose mode is invoked using the option <code class="docutils literal notranslate"><span class="pre">--mode</span> <span class="pre">verbose</span></code>, or setting <code class="docutils literal notranslate"><span class="pre">RUN_MODE</span></code> to <code class="docutils literal notranslate"><span class="pre">verbose</span></code> in settings.ini. (Using <code class="docutils literal notranslate"><span class="pre">--mode</span> <span class="pre">verbose</span></code> with <code class="docutils literal notranslate"><span class="pre">run-server</span></code> overrides the value in <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code>.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">debug</span></code>: this uses <a class="reference external" href="https://bottlepy.org">Bottle</a>’s development server instead of <code class="docutils literal notranslate"><span class="pre">mod_wsgi-express</span></code> and turns on maximum debugging options. This mode does <strong>not</strong> use <code class="docutils literal notranslate"><span class="pre">adapter.wsgi</span></code>. It will turn off template caching, will drop into pdb upon exceptions, and unlike <code class="docutils literal notranslate"><span class="pre">mod_wsgi-express</span></code>, the <a class="reference external" href="https://bottlepy.org">Bottle</a> server will also automatically reload any changed source files. In addition, the reloan wait time and loan expirations are set to 1 minute (overriding values set on individual items), and finally, the statistics gathering will include loans by staff users. (Normally, staff users are not included in the statistics to avoid skewing the results.) Debug mode is invoked using the option <code class="docutils literal notranslate"><span class="pre">--mode</span> <span class="pre">debug</span></code>. It has no corresponding <code class="docutils literal notranslate"><span class="pre">RUN_MODE</span></code> value in <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code>.</p></li>
</ul>
<p>Since debug mode uses <a class="reference external" href="https://bottlepy.org">Bottle</a>’s default server, the normal authentication mechanism is nonfunctional and you will not be able to access most pages <em>unless</em> you define a person using DIBS’s <code class="docutils literal notranslate"><span class="pre">people-manager</span></code> script (above) and give them the role of <code class="docutils literal notranslate"><span class="pre">library</span></code>, and then tell <code class="docutils literal notranslate"><span class="pre">run-server</span></code> the identity of that user.  To do this, use option <code class="docutils literal notranslate"><span class="pre">--user</span></code> with the name of the user you defined.  Here is an example of running in debug mode:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>admin/people-manager add <span class="nv">uname</span><span class="o">=</span><span class="s2">"debuguser"</span> <span class="nv">role</span><span class="o">=</span><span class="s2">"library"</span>
admin/run-server --mode debug --debug-user debuguser
</pre></div>
</div>
<p>This will start a local web server listening on <code class="docutils literal notranslate"><span class="pre">localhost</span></code> port 8080.  You can open a browser window on <code class="docutils literal notranslate"><span class="pre">http://localhost:8080</span></code> and you should see the DIBS welcome page, as well as be able to see the “List” and “Loan statistics” options in the pull-down menu from the upper right of the page.</p>
</section>
<section id="database-file-manifests-directory-and-iiif-server-url">
<h4 id="database-file-manifests-directory-and-iiif-server-url">Database file, manifests directory, and IIIF server URL<a class="headerlink" href="#database-file-manifests-directory-and-iiif-server-url" title="Permalink to this heading">¶</a></h4>
<p>A number of additional command-line options for <code class="docutils literal notranslate"><span class="pre">run-server</span></code> allow you to override values set in <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code>. These are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--database</span></code>: override the value of <code class="docutils literal notranslate"><span class="pre">DATABASE_FILE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--manifests</span></code>: override the value of <code class="docutils literal notranslate"><span class="pre">MANIFEST_DIR</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--iiif_url</span></code>: override the value of <code class="docutils literal notranslate"><span class="pre">IIIF_BASE_URL</span></code></p></li>
</ul>
<p>Please consult the comments in <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code> or the DIBS documentation for more information about the purpose of these configuration variables.</p>
</section>
<section id="additional-options">
<h4 id="additional-options">Additional options<a class="headerlink" href="#additional-options" title="Permalink to this heading">¶</a></h4>
<p>In a live server, the default base URL for DIBS is normally set by the Apache2 configuration. For the local server started by this program, the default is <a class="reference external" href="http://localhost:8080">http://localhost:8080</a>. The option <code class="docutils literal notranslate"><span class="pre">--base-url</span></code> can be used to change this. The value given to <code class="docutils literal notranslate"><span class="pre">--base-url</span></code> should contain the protocol, hostname, port (if needed) and any additional path elements of the root of DIBS on the server; e.g., “<a class="reference external" href="https://library.example.edu/dibs">https://library.example.edu/dibs</a>”. (Note: the path component is ignored when running in debug mode.)</p>
<p>By default, <code class="docutils literal notranslate"><span class="pre">run-server</span></code> looks for a WSGI adapter named <code class="docutils literal notranslate"><span class="pre">adapter.wsgi</span></code> in the current directory. The option <code class="docutils literal notranslate"><span class="pre">--adapter</span></code> can be used to tell <code class="docutils literal notranslate"><span class="pre">run-server</span></code> to use a different file.</p>
</section>
</section>
<section id="set-server-permissions-set-essential-directory-permissions">
<h3 id="set-server-permissions-set-essential-directory-permissions"><code class="docutils literal notranslate"><span class="pre">set-server-permissions</span></code>: set essential directory permissions<a class="headerlink" href="#set-server-permissions-set-essential-directory-permissions" title="Permalink to this heading">¶</a></h3>
<p>This program sets certain basic file and directory permissions for a typical server configuration of DIBS.  It only affects a small number of items that will not have the correct permissions after cloning the git repository. The arguments <code class="docutils literal notranslate"><span class="pre">--owner</span></code> and <code class="docutils literal notranslate"><span class="pre">--group</span></code> can be used to choose the owner and group to be used for the permissions.  Normally, this would be the Apache server user and group.  For example, if the user name is “www-data” and the group name is “www-data”, then you would run this program as follows:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>admin/set-server-permissions --owner www-data --group www-data
</pre></div>
</div>
</section>
<section id="test-folio-token-check-the-folio-token-is-still-valid">
<h3 id="test-folio-token-check-the-folio-token-is-still-valid"><code class="docutils literal notranslate"><span class="pre">test-folio-token</span></code>: check the FOLIO token is still valid<a class="headerlink" href="#test-folio-token-check-the-folio-token-is-still-valid" title="Permalink to this heading">¶</a></h3>
<p>When using FOLIO as the LSP, DIBS needs to contact FOLIO for metadata when staff add new items to DIBS. FOLIO uses API tokens for authentication, and those tokens eventually get invalidated. When that happens, DIBS calls will fail. Consequently, it’s a good idea to periodically test the FOLIO credentials and update the token stored in the <code class="docutils literal notranslate"><span class="pre">settings.ini</span></code> file. The utility <code class="docutils literal notranslate"><span class="pre">test-folio-token</span></code> is useful for that purpose.</p>
<p>Without any arguments, it will simply return a non-zero status number if the credentials are invalid.  If given the <code class="docutils literal notranslate"><span class="pre">--slack</span></code> argument, the value must be in the form <em>slack-channel:slack-token</em>; in that case, this program will post a message to the channel if the FOLIO credentials are invalid. Here is an example of a crontab line for daily testing of the FOLIO credentials and posting to a (fake) Slack channel named “my-channel”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="mi">8</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">dibs</span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">folio</span><span class="o">-</span><span class="n">token</span> <span class="o">--</span><span class="n">slack</span> <span class="n">my</span><span class="o">-</span><span class="n">channel</span><span class="p">:</span><span class="n">xoxb</span><span class="o">-</span><span class="mi">895</span><span class="o">-</span><span class="n">asfd123</span>
</pre></div>
</div>
</section>
<section id="update-item-data-update-item-records-with-current-values-from-lsp">
<h3 id="update-item-data-update-item-records-with-current-values-from-lsp"><code class="docutils literal notranslate"><span class="pre">update-item-data</span></code>: update item records with current values from LSP<a class="headerlink" href="#update-item-data-update-item-records-with-current-values-from-lsp" title="Permalink to this heading">¶</a></h3>
<p>This program reads the DIBS database file, compares every item’s metadata fields to the values of the corresponding record in the LSP, displays the differences (if any), and offers to update the DIBS objects to match the LSP records. Example usage:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>admin/update-item-data
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">update-item-data</span></code> can be run on a live server. At Caltech, we wrote this program because our catalog search service (EDS – EBSCO Discovery Service) changed the permalink scheme on multiple occasions, causing the DIBS links to item description pages to become invalid. Since the links are stored in the DIBS database when new items are added, there needs to be a method to update the links as needed. We wrote <code class="docutils literal notranslate"><span class="pre">update-item-data</span></code> for that purpose.</p>
</section>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="architecture.html" title="System architecture"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> System architecture </span>
              </div>
            </a>
          
          
            <a href="general.html" title="General information"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> General information </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2022, Caltech Library.
              
          </div>
            Last updated on
              Oct 13, 2022.
            <br/>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.2.3.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>